<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
</head>
<body>

    <canvas id="gameVisualisation" width="1024" height="768">
        Your browser does not support Canvas element. Shame on you!
    </canvas>

    <script type="application/javascript" src="js/jquery-1.11.1.js"></script>
    <script type="application/javascript" src="js/fabric.js"></script>
    <script type="application/javascript">
        $(document).ready(function() {
            // to make Objects rotate around center - not top-left corner
            fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';
            // no object is selectable
            fabric.Object.prototype.selectable = false;
            // custom elementId for all objects
            fabric.Object.prototype.elementId = '';

            var canvas = new fabric.Canvas('gameVisualisation');
            canvas.backgroundColor = 'rgb(0,0,0)';

            var triangle = new fabric.Triangle({
                width:20,
                height:30,
                fill:'rgb(255,255,255)',
                left: canvas.getWidth() / 2,
                top: canvas.getHeight() / 2
            });
            var circle = new fabric.Circle({
                radius:3,
                fill:'rgb(255,0,0)',
                left: canvas.getWidth() / 2,
                top: canvas.getHeight() / 2 - 100
            });
            canvas.add(triangle, circle);

            triangle.elementId = '1';
            circle.elementId = '2';

            var elements = [triangle, circle];

            var refreshElement = function (element, newVals) {
                element.set({
                    top: newVals.y,
                    left: newVals.x,
                    angle: newVals.direction
                })
            };

            function refresh(newVals) {
            	console.log(newVals);
                for (var i = 0 ; i < elements.length ; ++i) {
                    var element = elements[i];
                    var config = newVals[element.elementId];
                    refreshElement(element, config);
                }
                canvas.renderAll();
            }

            function getRandomVal (maxVal) {
            	var v = Math.floor((Math.random() * maxVal) + 1)
            	console.log("MAXVAL " + maxVal + " return " + v);
            	return v;
            }

            function randomRefresh() {
                refresh({
                    '1' : {
                        x : getRandomVal(canvas.getWidth()),
                        y : getRandomVal(canvas.getHeight()),
                        direction: getRandomVal(360)
                    },
                    '2' : {
                        x : getRandomVal(canvas.getWidth()),
                        y : getRandomVal(canvas.getHeight()),
                        direction: getRandomVal(360)
                    }
                });
                setTimeout(randomRefresh, 1000);
            }

            setTimeout(randomRefresh, 1000);

            $(document).keydown(function(e) {
                var a = triangle.getAngle();
                switch(e.which) {
                    case 37:
                            triangle.setAngle(a - 5);
                            canvas.renderAll(); // if not set will be painted after another action on canvas
                        break;
                    case 39:
                            triangle.setAngle(a + 5);
                            canvas.renderAll();
                        break;

                    default: return;
                }
                e.preventDefault(); // prevent the default action (scroll / move caret)
            });
        });
    </script>
</body>
</html>